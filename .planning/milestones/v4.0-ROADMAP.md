# Milestone v4.0: Raycast Integration

**Status:** SHIPPED 2026-02-24
**Phases:** 18-21
**Total Plans:** 7

## Overview

Bring Tokemon's usage monitoring to Raycast as a standalone TypeScript/React extension, reaching developers where they already work. Standalone architecture fetching data directly via OAuth — works without Tokemon.app running. New codebase in `tokemon-raycast/` directory.

## Phases

### Phase 18: Extension Foundation

**Goal:** Scaffold a working Raycast extension with credential handling and custom branding
**Depends on:** Nothing (first phase of v4.0)
**Requirements:** EXT-01, EXT-02, EXT-03, EXT-04
**Plans:** 2 plans

Plans:
- [x] 18-01-PLAN.md -- Scaffold project, export icon, configure manifest, MIT license, README
- [x] 18-02-PLAN.md -- Setup wizard command, API constants, token validation, stub dashboard

**Success Criteria:**
1. User can install extension via `npm install && npm run dev`
2. Extension appears in Raycast with Tokemon icon
3. User can enter OAuth token via setup wizard
4. Extension stores credentials securely in Raycast LocalStorage

### Phase 19: Dashboard Command

**Goal:** Users can view their Claude usage stats in a Raycast command
**Depends on:** Phase 18
**Requirements:** DASH-01, DASH-02, DASH-03, DASH-04, DASH-05
**Plans:** 2 plans

Plans:
- [x] 19-01-PLAN.md -- TDD: TypeScript types for API response and pure utility functions (countdown, pace, formatting)
- [x] 19-02-PLAN.md -- Dashboard UI with Detail.Metadata, live countdown timer, and Cmd+R refresh

**Success Criteria:**
1. User sees session usage percentage in dashboard
2. User sees weekly usage percentage in dashboard
3. User sees reset countdown timer
4. User sees pace indicator (on track / ahead / behind)
5. User can manually refresh data with Cmd+R

### Phase 20: Menu Bar Command

**Goal:** Usage percentage persists in Raycast menu bar with automatic refresh
**Depends on:** Phase 19
**Requirements:** MENU-01, MENU-02, MENU-03
**Plans:** 1 plan

Plans:
- [x] 20-01-PLAN.md -- Menu bar command with colored icon, percentage display, and 5m background refresh

**Success Criteria:**
1. Usage percentage displays in Raycast menu bar
2. Menu bar updates automatically without user action
3. Menu bar color reflects usage level (green/orange/red)

### Phase 21: Multi-Profile & Alerts

**Goal:** Power users can manage multiple accounts and configure threshold alerts
**Depends on:** Phase 20
**Requirements:** PROF-01, PROF-02, PROF-03, ALRT-01, ALRT-02, ALRT-03
**Plans:** 2 plans

Plans:
- [x] 21-01-PLAN.md -- Profile types, profiles command (add/switch/delete), token resolution in dashboard and menu bar
- [x] 21-02-PLAN.md -- Settings command with threshold config, alert logic in menu bar background refresh, human verification

**Success Criteria:**
1. User can add multiple profiles with different OAuth tokens
2. User can switch between profiles
3. User can delete profiles
4. User can configure usage threshold percentage for alerts
5. User receives Raycast notification when threshold is reached
6. User can test alert from settings command

---

## Milestone Summary

**Key Decisions:**
- Standalone extension (no Tokemon.app dependency) — fetches via OAuth directly
- TypeScript/React with @raycast/api (not Swift)
- Manual token entry via password preferences (Keychain causes Store rejection)
- vitest over jest for testing (zero-config TypeScript, ESM-native)
- useCachedState for cross-command profile sync
- showHUD over showToast for background alert visibility
- onData callback for side effects (not useEffect)
- Memoized TokenSource for stable useCachedPromise caching

**Issues Resolved:**
- useForm enableReinitialize not supported — split into loader + form pattern
- Token flickering during profile load — memoized TokenSource identity
- Menu bar blank without token — Icon.Warning fallback (never null)

**Issues Deferred:**
- Raycast Store submission (requires author field update, review process)
- Token auto-refresh in Raycast context (manual re-entry if token expires)

**Technical Debt Incurred:**
- colorMap duplicated across commands (not shared utility)
- No integration tests for Raycast commands (only unit tests for pure functions)

---

_For current project status, see .planning/ROADMAP.md_
