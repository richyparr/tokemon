---
phase: 05-theming-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ClaudeMon/Utilities/Theme.swift
  - ClaudeMon/Utilities/Color+Hex.swift
  - ClaudeMon/Views/Settings/AppearanceSettings.swift
autonomous: true

must_haves:
  truths:
    - "ThemeManager observable class exists with selectedTheme property"
    - "Three themes defined: native, minimalDark, anthropic"
    - "ThemeColors struct resolves semantic colors based on theme and colorScheme"
    - "User can select theme via radio group picker in Appearance settings"
    - "Theme selection persists via UserDefaults"
  artifacts:
    - path: "ClaudeMon/Utilities/Theme.swift"
      provides: "AppTheme enum, ThemeColors struct, ThemeManager @Observable"
      contains: "enum AppTheme"
    - path: "ClaudeMon/Utilities/Color+Hex.swift"
      provides: "Hex color initialization for Color and NSColor"
      contains: "init(hex:"
    - path: "ClaudeMon/Views/Settings/AppearanceSettings.swift"
      provides: "Theme picker UI"
      contains: "ThemeManager"
  key_links:
    - from: "ClaudeMon/Views/Settings/AppearanceSettings.swift"
      to: "ClaudeMon/Utilities/Theme.swift"
      via: "@Environment(ThemeManager.self)"
      pattern: "@Environment\\(ThemeManager\\.self\\)"
    - from: "ClaudeMon/Utilities/Theme.swift"
      to: "UserDefaults"
      via: "selectedTheme didSet"
      pattern: "UserDefaults\\.standard\\.set"
---

<objective>
Create the theme infrastructure for ClaudeMon: AppTheme enum defining three themes, ThemeColors struct for semantic color resolution, and ThemeManager @Observable for state management. Then add theme picker UI to AppearanceSettings.

Purpose: Establish the foundation for multi-theme support that will be wired to views in Plan 02.
Output: Theme.swift, Color+Hex.swift, updated AppearanceSettings.swift with working theme picker
</objective>

<execution_context>
@/Users/richardparr/.claude/get-shit-done/workflows/execute-plan.md
@/Users/richardparr/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-theming-polish/05-RESEARCH.md

# Existing files to reference
@ClaudeMon/Views/Settings/AppearanceSettings.swift
@ClaudeMon/Utilities/GradientColors.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Theme Infrastructure</name>
  <files>
    ClaudeMon/Utilities/Theme.swift
    ClaudeMon/Utilities/Color+Hex.swift
  </files>
  <action>
Create two new files in ClaudeMon/Utilities/:

**Color+Hex.swift:**
- Add `extension Color` with `init(hex: UInt64, opacity: Double = 1.0)` using sRGB color space
- Add `extension NSColor` with `convenience init(hex: UInt64, alpha: CGFloat = 1.0)` using sRGB
- Use bit shifting: red = (hex >> 16) & 0xff, green = (hex >> 8) & 0xff, blue = hex & 0xff
- Divide by 255.0 for normalized values

**Theme.swift:**
Create three components:

1. `AppTheme` enum (String, CaseIterable, Identifiable):
   - Cases: `native = "Native macOS"`, `minimalDark = "Minimal Dark"`, `anthropic = "Anthropic"`
   - `var id: String { rawValue }`

2. `ThemeColors` struct:
   - Properties: `theme: AppTheme`, `colorScheme: ColorScheme`
   - Computed properties for semantic colors:
     - `primaryBackground: Color` - native: .windowBackgroundColor, minimalDark: #1a1a1a, anthropic: dark=#141413 light=#faf9f5
     - `primaryAccent: Color` - native: .accentColor, minimalDark: #4a9eff, anthropic: #c15f3c (Crail orange)
     - `secondaryText: Color` - native: .secondaryLabelColor, minimalDark: #8e8e93, anthropic: #b0aea5
     - `chartGradientColors: [Color]` - native: [.accentColor.opacity(0.4), .accentColor.opacity(0.1)], minimalDark: [#4a9eff variants], anthropic: [#c15f3c variants]
     - `colorSchemeOverride: ColorScheme?` - native: nil (follows system), minimalDark: .dark, anthropic: nil

3. `ThemeManager` class (@Observable, @MainActor, final):
   - `var selectedTheme: AppTheme = .native` with didSet storing to UserDefaults key "selectedTheme"
   - `init()` that loads from UserDefaults if stored value exists
   - Computed `func colors(for colorScheme: ColorScheme) -> ThemeColors` that returns ThemeColors(theme: selectedTheme, colorScheme: colorScheme)

Import SwiftUI and AppKit.
  </action>
  <verify>
`swift build` compiles without errors. Both files exist in ClaudeMon/Utilities/.
  </verify>
  <done>
Theme infrastructure exists: AppTheme enum with 3 cases, ThemeColors with semantic color resolution, ThemeManager with UserDefaults persistence.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Theme Picker to AppearanceSettings</name>
  <files>
    ClaudeMon/Views/Settings/AppearanceSettings.swift
  </files>
  <action>
Update AppearanceSettings.swift to add a theme selection UI:

1. Add `@Environment(ThemeManager.self) private var themeManager` at the top of the struct

2. Add a new Section before the existing "Menu Bar Display" section:
   ```swift
   Section {
       @Bindable var manager = themeManager

       Picker("Theme", selection: $manager.selectedTheme) {
           ForEach(AppTheme.allCases) { theme in
               Text(theme.rawValue).tag(theme)
           }
       }
       .pickerStyle(.radioGroup)

       // Description text based on selected theme
       Text(themeDescription)
           .font(.caption)
           .foregroundStyle(.secondary)
   } header: {
       Text("Theme")
   }
   ```

3. Add computed property for theme description:
   ```swift
   private var themeDescription: String {
       switch themeManager.selectedTheme {
       case .native:
           return "Follows your macOS appearance settings"
       case .minimalDark:
           return "Always dark with muted accent colors"
       case .anthropic:
           return "Warm tones inspired by Anthropic's brand"
       }
   }
   ```

Note: The ThemeManager will be injected via .environment() in Plan 02. For now, the view references it but won't have the environment until wiring is complete.
  </action>
  <verify>
`swift build` compiles. AppearanceSettings.swift contains theme picker with radio group, @Environment for ThemeManager, and theme description text.
  </verify>
  <done>
AppearanceSettings has a Theme section with radio picker for Native macOS, Minimal Dark, and Anthropic options, plus descriptive help text for each theme.
  </done>
</task>

</tasks>

<verification>
1. `swift build` completes successfully
2. ClaudeMon/Utilities/Theme.swift exists with AppTheme, ThemeColors, ThemeManager
3. ClaudeMon/Utilities/Color+Hex.swift exists with hex color extensions
4. ClaudeMon/Views/Settings/AppearanceSettings.swift has Theme section with picker
5. ThemeManager stores selection to UserDefaults key "selectedTheme"
</verification>

<success_criteria>
- Theme infrastructure compiled and ready for use
- Three themes defined with distinct color palettes
- Theme picker UI in settings (will become functional after Plan 02 wires environment)
- No build errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-theming-polish/05-01-SUMMARY.md`
</output>
