---
phase: 09-shareable-moments
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ClaudeMon/Views/ShareableCard/ShareableCardView.swift
  - ClaudeMon/Services/ExportManager.swift
autonomous: true

must_haves:
  truths:
    - "ShareableCardView renders usage stats with ClaudeMon branding"
    - "ExportManager can render a SwiftUI view to NSImage"
    - "ExportManager can copy an NSImage to the system clipboard"
  artifacts:
    - path: "ClaudeMon/Views/ShareableCard/ShareableCardView.swift"
      provides: "Shareable card SwiftUI view with branding"
      contains: "struct ShareableCardView"
    - path: "ClaudeMon/Services/ExportManager.swift"
      provides: "Image rendering and clipboard copy methods"
      exports: ["renderToImage", "copyImageToClipboard", "copyViewToClipboard"]
  key_links:
    - from: "ExportManager"
      to: "ShareableCardView"
      via: "copyViewToClipboard renders card to clipboard"
      pattern: "copyViewToClipboard.*ShareableCardView"
---

<objective>
Build the ShareableCardView template and extend ExportManager with clipboard copy functionality.

Purpose: Create the core shareable card infrastructure (view + clipboard methods) that the integration plan will wire into the UI.
Output: ShareableCardView.swift, extended ExportManager with renderToImage/copyImageToClipboard/copyViewToClipboard methods.
</objective>

<execution_context>
@/Users/richardparr/.claude/get-shit-done/workflows/execute-plan.md
@/Users/richardparr/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-shareable-moments/09-RESEARCH.md
@ClaudeMon/Views/Analytics/PDFReportView.swift
@ClaudeMon/Services/ExportManager.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ShareableCardView</name>
  <files>ClaudeMon/Views/ShareableCard/ShareableCardView.swift</files>
  <action>
Create `ClaudeMon/Views/ShareableCard/ShareableCardView.swift` with a self-contained SwiftUI view for shareable usage cards.

CRITICAL constraints (from research):
- NO @Environment dependencies (ImageRenderer limitation)
- NO gradients (use solid colors only - macOS ImageRenderer bug)
- All data passed as init parameters

View requirements:
- Card size: 320x200 points (will render at 640x400px at 2x scale)
- White background (cardBackground = Color.white)
- ClaudeMon branding: "ClaudeMon" text in Anthropic orange (0xc15f3c) at top-left
- "Claude Usage Stats" subtitle in gray below branding
- Period label (e.g., "This Week") at top-right in gray
- Main stat: Large utilization percentage (56pt bold rounded font)
- Optional stats: Top project name and token count in pill badges
- Footer: "claudemon.app" text at bottom-right for viral marketing

Parameters:
```swift
let periodLabel: String          // "This Week" or "February 2026"
let utilizationPercentage: Double
let topProjectName: String?      // Optional
let totalTokensUsed: Int?        // Optional
let generatedDate: Date
```

Include a private `formatTokens(_ count: Int) -> String` helper for 1M/1K formatting.

Follow PDFReportView pattern: explicit foreground colors (.black, .gray), no reliance on system appearance.
  </action>
  <verify>
Build succeeds: `cd /Users/richardparr/ClaudeMon && xcodebuild -scheme ClaudeMon -quiet build 2>&1 | tail -5`
File exists and contains struct: `grep -l "struct ShareableCardView" ClaudeMon/Views/ShareableCard/ShareableCardView.swift`
  </verify>
  <done>ShareableCardView.swift exists with self-contained view, solid colors only, all required data as parameters, ClaudeMon branding, and viral marketing URL.</done>
</task>

<task type="auto">
  <name>Task 2: Extend ExportManager with clipboard methods</name>
  <files>ClaudeMon/Services/ExportManager.swift</files>
  <action>
Extend ExportManager.swift (already @MainActor struct with static methods) with three new methods:

1. `renderToImage<V: View>(_ view: V, scale: CGFloat = 2.0) -> NSImage?`
   - Create ImageRenderer with the view
   - Set renderer.scale = scale (2.0 for Retina)
   - Get cgImage from renderer, return nil if fails
   - Create NSImage from CGImage with correct size (cgImage dimensions / scale)

2. `copyImageToClipboard(_ image: NSImage) -> Bool`
   - Get NSPasteboard.general
   - Call pasteboard.clearContents() (CRITICAL: must clear before write)
   - Return pasteboard.writeObjects([image])

3. `copyViewToClipboard<V: View>(_ view: V) -> Bool`
   - Convenience method combining render + copy
   - Call renderToImage(view), return false if nil
   - Call copyImageToClipboard with the image, return result

Add these methods after the existing CSV methods, with a `// MARK: - Image Rendering & Clipboard` section header.
  </action>
  <verify>
Build succeeds: `cd /Users/richardparr/ClaudeMon && xcodebuild -scheme ClaudeMon -quiet build 2>&1 | tail -5`
Methods exist: `grep -E "renderToImage|copyImageToClipboard|copyViewToClipboard" ClaudeMon/Services/ExportManager.swift`
  </verify>
  <done>ExportManager has renderToImage, copyImageToClipboard, and copyViewToClipboard static methods for clipboard image operations.</done>
</task>

</tasks>

<verification>
1. Build passes with no errors
2. ShareableCardView.swift exists in Views/ShareableCard/
3. ExportManager has three new clipboard-related methods
4. No @Environment in ShareableCardView
5. No LinearGradient/AngularGradient/RadialGradient in ShareableCardView
</verification>

<success_criteria>
- ShareableCardView renders usage data with ClaudeMon branding and viral URL
- ExportManager can render SwiftUI views to NSImage and copy to clipboard
- Build succeeds with no warnings related to new code
- Code follows established patterns (static methods, solid colors, no @Environment)
</success_criteria>

<output>
After completion, create `.planning/phases/09-shareable-moments/09-01-SUMMARY.md`
</output>
